---
title: "Do Data Better"
author: "Ryan Derickson & Jena Wierwille, SIOP 2019"
output: 
  ioslides_presentation:
    smaller: true
---


```{r setup, include=FALSE}

# makes default to not display code, just results
knitr::opts_chunk$set(echo = FALSE)

library(plotly)
library(leaflet)

# define color codes, RGB commented
cred<-"#CD0835"     # 205, 8, 53
corange<-"#F97D01"  # 249, 125, 1
cgray<-"#57585a"    # 87, 88, 90
cgreen<-"#17A599"   # 23, 165, 153
cblue<-"#00a2e8"    # 0, 162, 232
cpurple<-"#a349a4"  # 163, 73, 164 

# function to tidy up the coloring of text w/html
ct<-function(col, txt){
  paste0("<font color='", col, "'>", txt, "</font>")
}

```


<!-- css for background-->
<style>

slide {
background-color: #fff;
}

</style>




## Housekeeping

All the materials we'll cover today are available at https://github.com/ryanderickson/2019siop. If you use GitHub, you know what to do. If you don't use GitHub, here's a good excuse to start. 


Important files:

- [README.md](https://github.com/ryanderickson/2019siop/blob/master/README.md) - our bios and table of contents 

- [slides.md](https://github.com/ryanderickson/2019siop/blob/master/README.md) - the code that generated this deck  

- [flexdashboard.Rmd](https://github.com/ryanderickson/2019siop/blob/master/README.md) - the flexdashboard example  

- [shinydashboard.Rmd](https://github.com/ryanderickson/2019siop/blob/master/README.md) - the shinydashboard example  







## Bottom line up front

We're tired of seeing good data collection and analysis go to waste. We want to share how (relatively) easy it can be to present data more effectively. 

Our goal today is to show you what's possible and give you ideas to follow up on later - there's just not time to cover everything in detail in 50 minutes. `r ct(corange, "**Focus on the concepts, not the code - you can figure out the code later**")`.

That said, help us make the most of this time. Who...

> - often does data viz or presentation as part of your job?
> - is familiar with R?  
> - has used R for production (i.e., not just analyses)?







## {.flexbox .vcenter}

`r ct(cred, "\"I used to think that the worst thing in life is to end up alone. It's not. The worst thing in life is to end up with people who make you <strike>feel alone</strike> <b>sit through an awful data presentation</b>.\"")` <br><br> - Robin Williams (mostly)






## Data presentation bingo {.flexbox .vcenter}

<div class="centered">
```{r, out.width="100%"}

# :: says use the include_graphics function from the knitr package
knitr::include_graphics("bingo.png")
```
</div>







## More mildly

> - "I guess I'm not a data person."  
> - "This is too complex."  
> - "So what do I do with this?"  
> - "This is too much data."  

<br>

> - i.e., **"I'm not benefitting from the data."**







## 

<br><br><br><br><br><br><br><br>

`r ct(cred, "\"There's no such thing as information overload, only poor design.\"")` <br><br>- Edward Tufte (completely)






# Data viz best practices







## Just in Time

JIT - apply principles from manufacturing to data science to reduce wasted time and effort (the tools and software we'll cover soon help you achieve these).  

> - `r ct(cgreen, "**Produce only what's needed**")`   
> - `r ct(cgreen, "**Make it beautiful and engaging**")`  
> - `r ct(cgreen, "**Integrate when possible**")`     
> - `r ct(cgreen, "**Make it easy to access**")`  
> - `r ct(cgreen, "**Help users draw conclusions**")` 






## Supporting materials

JW - stuff about material design, tailoring for audience, etc.







## Here's what we've done

JW - demo AES dashboard, explain philosophy 








# R and friends








## Tech stack

1. [R](https://www.r-project.org/) ~ iPhone
2. [RStudio](https://www.rstudio.com/) ~ iOS
3. [Packages](https://cran.r-project.org/) ~ apps

<br>

Why should you use R if you don't already?








## There's a huge ecosystem

- Incorporates new developments sooner, more flexibly
- Integrates well with other useful tools
    - Python
    - SQL
    - TensorFlow
    - H<sub>2</sub>O.ai
    - Stan
    - Hugo
    - Web (.css, .js)
    - LaTeX
    - MS Office







## R improves your quality of life

- Creates one workflow from data cleaning to presentation (more on this soon)  
- Ensures everything is current via piping  
- Compile to .pdf, .html, .docx, etc. with minimal edits    
- Handles tedium for you (more on this soon)
- Do more with less code...







## 1 line of code {.flexbox .vcenter}

```{r echo=TRUE, message=FALSE, warning=FALSE, fig.width=6, results="asis"}

plot_ly(economics, x = ~date, y = ~unemploy / pop)

```







## 3 lines of code

```{r echo=TRUE, message=FALSE, warning=FALSE, fig.width=8, fig.height=3.75, results="asis"}

leaflet() %>%
  addTiles() %>%
  addMarkers(lat = 38.781366, lng = -77.013841, popup = "We're here!")

```







## R is free & open source

*"But can I really trust it if it's free...?"*  Lots of people do.

```{r, out.width="95%"}

knitr::include_graphics("logos.png")

```







# flexdashboard







```{r, include=FALSE}

library(magrittr)
library(visNetwork)

path<-"https://raw.githubusercontent.com/ryanderickson/2019siop/master/"

edges<-data.frame(from=c(5,5,4,4,1,1,6,3,6),
                  to=  c(1,3,1,3,6,3,3,6,2))


nodes<-data.frame(id=1:6,
                  shape="image",
                  image=paste0(path, 1:6, ".png"))

vn<-visNetwork(nodes, edges,width="500px", height="300px") %>%
  visNodes(shapeProperties=list(useBorderWithImage=FALSE)) %>%
  visEdges(arrows=list(to=list(enabled=TRUE)),
           color=list(color="gray", highlight="black")) %>%
  visLayout(randomSeed=5)

visSave(vn, "workflow net.html")

```







## Normal workflow

<iframe src="workflow net.html" style="border:0;"></iframe>








## RMarkdown workflow {.flexbox .vcenter}

![](https://www.rstudio.com/wp-content/uploads/2014/04/rmarkdown-200x232.png)






## No more...

final.xlsx  
FINAL.xlsx   
OMGFINAL.xlsx   
OMGFINAL_1.xlsx  
presentation.ppt  
new_presentation.ppt  
mypresentation_new.ppt  
new_use_this_one_really.ppt  
submission.docx  
submission2.pdf  
etc.

<br>

Instead, you have...

`r ct(corange, "project.Rmd")`. Pair with GitHub for easy collaboration and tracking.  






## Self-contained interactivity

```{r echo=TRUE, eval=FALSE}
install.packages("flexdashboard")
```

flexdashboard is a special RMarkdown template that handles most of the tedium of creating a dashboard. It comes with functions for sizing, styling, content containers, etc. already built for you.    

```
RStudio / File / New File / R Markdown / From Template / Flex Dashboard

```

This opens a new flexdashboard template. You write R code to handle the data, plain text with markup to style it, and use the functions in flexdashbaord to set the layout you want - `r ct(corange, "all in the same file")`. 

**knitting** the file renders your text with markup in the layout you specify, runs the R code in the code chunks, and inserts their outputs (graphs, tables, etc.) where they should go.








 
## Just like this...

<br><br>

<div class="centered">
<video src="flexdashboard sg.mp4" type="video/mp4" width="500" controls></video>
</div>
  
   






## 

```{r echo=TRUE, eval=FALSE}

title: "Untitled"
output: 
  flexdashboard::flex_dashboard:
  orientation: columns
vertical_layout: fill

```


**YAML** sets the title and output format. The default values are fine so you don't have to do anything here unless you want something specific. 








##

```{r echo=TRUE, eval=FALSE}

Column {data-width=600}
-----------------------------------------------------------------------
  
  ### Where we are
  
  ``{r}
leaflet() %>%
  addTiles() %>%
  addMarkers(lat = 38.781366, lng = -77.013841, popup = "We're here!")
``

### Where we're going

<p>
  We can <b>write</b> in these boxes too. (Virtually) anything that could go on 
a webpage could go in a flexbox.
</p>
  
```
  
  

``` '''{r}``` defines a chunk of R code. This evaluates when you knit and whatever it produces gets inserted into the flexbox associated with that chunk.
  
  Here, we have a column 60% of the screen width (600 / 1000) and we fill it with two flexboxes stacked on top of each other. The first one has a chunk of R code that makes a map, and the second one has text with HTML markup.
  
  



  
  
  
## Styling - themes
  
```{r echo=TRUE, eval=FALSE}
  
  title: "Untitled"  
  output:   
    flexdashboard::flex_dashboard:  
    orientation: columns  
  vertical_layout: fill  
  theme: bootstrap  
  
```
  
  
  Flexdashboard uses the [Bootswatch](https://bootswatch.com/) framework. Many themes are available. To use or change a theme, just specify the one you want in the YAML and knit.
  
  
  
  
  
  
  
## Styling - custom
  
```{r echo=TRUE, eval=FALSE}
  
  title: "Untitled"
  output: 
    flexdashboard::flex_dashboard:
    orientation: columns
  vertical_layout: fill
  css: styles.css
  
```
  
  
If you want total control over your dashboard's appearance, you can use your own css. This is more work on the front end, but can be incredibly efficient over time (only need to make changes in one place). 
  
If your organization or client has a website, they have their own css. Steal it!
  
  
  
  
  
  
  
  
## Automation
  
Suppose your company has 10 locations and you want to make a flexdashboard for each one. Simply set up a **template** and a **driver** R file. 
  
The driver file subsets your data to each of the 10 location, and hands those subsets off to the template. The template and driver file talk to each other automatically because they share an environment (like being in the same room).
  
Your template flexdashboard is called ```template.Rmd``` and your data object is ```data```.
  
```{r echo=TRUE, eval=FALSE}
  
  for(i in unique(data$location)){
  temp <- data[data$location == i, ]
  rmarkdown::render(input = "template.Rmd")
  }
  
```
  
```template.Rmd``` is set up to build graphs, etc. from the ```temp``` object. As R loops thought the locations, ```temp``` holds the data for each one.
  
```rmarkdown::render()``` does the same thing as the **knit** button.
  
  
  
  
  
  
## Big picture
  
Open a flexdashboard template, set the layout you want, and use chunks of R code to populate the flexboxes. **knit** the file to tell R to turn the code into HTML your web browser can read, or automate with a driver file. 
  
**Pros**  
  
  > - Easy! (after the first couple times...)   
  > - Self-contained but interactive because it takes advantage of your web browser.   
  > - Can be emailed, posted, etc. and users don't have to do anything special.  
  > - Can add custom HTML, .css, .js if desired to customize the look or behavior.
  > - Can be automated!
  
  **Cons**  
  
  > - Interactivity is limited to HTML widgets - leaflet, plotly, DT, etc. 
  > - No server-side capability, so changes mean you have to recompile.  
  > - Occasional behavior differences across web browsers.  
  
  
  
  
  
  
  
# shinydashboard
  
  
  
  
  
  
  